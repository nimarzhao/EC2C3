\usepackage{mathtools}
\usepackage{xparse}

%   Expectation
    \NewDocumentCommand{\expect}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\mathbb{E}}%     the variance operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after Var
      \IfValueT{#1}{^{\mathbb{#1}}}% superscript immediately after Var
      \IfBooleanTF{#3}{% *-variant
        \expectarg*{\expectvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \expectarg{\expectvar#5}%
        }{% optional argument
          \expectarg[#4]{\expectvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\expectvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\expectarg}[1]{[}{]}{#1}



%   Variance
    \NewDocumentCommand{\var}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\mathrm{var}}%     the variance operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after Var
      \IfValueT{#1}{^{\mathbb{#1}}}% superscript immediately after Var
      \IfBooleanTF{#3}{% *-variant
        \vararg*{\varvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \vararg{\varvar#5}%
        }{% optional argument
          \vararg[#4]{\varvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\varvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\vararg}[1]{(}{)}{#1}


%   Covariance
    \NewDocumentCommand{\cov}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\mathrm{cov}}%     the covariance operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after Cov
      \IfValueT{#1}{^{\mathbb{#1}}}% superscript immediately after Cov
      \IfBooleanTF{#3}{% *-variant
        \covarg*{\covvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \covarg{\covvar#5}%
        }{% optional argument
          \covarg[#4]{\covvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\covvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\covarg}[1]{(}{)}{#1}


%   Correlation
    \NewDocumentCommand{\corr}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\mathrm{corr}}%     the correlation operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after Corr
      \IfValueT{#1}{^{\mathbb{#1}}}% superscript immediately after Corr
      \IfBooleanTF{#3}{% *-variant
        \corrarg*{\corrvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \corrarg{\corrvar#5}%
        }{% optional argument
          \corrarg[#4]{\corrvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\corrvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\corrarg}[1]{(}{)}{#1}

% Estimators

%   Variance
    \NewDocumentCommand{\evar}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\widehat{\mathrm{var}}}%     the variance operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after Var
      \IfValueT{#1}{^{\mathbb{#1}}}% superscript immediately after Var
      \IfBooleanTF{#3}{% *-variant
        \evararg*{\evarvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \evararg{\evarvar#5}%
        }{% optional argument
          \evararg[#4]{\evarvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\evarvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\evararg}[1]{(}{)}{#1}


%   Covariance
    \NewDocumentCommand{\ecov}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\widehat{\mathrm{cov}}}%     the covariance operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after Cov
      \IfValueT{#1}{^{\mathbb{#1}}}% superscript immediately after Cov
      \IfBooleanTF{#3}{% *-variant
        \ecovarg*{\ecovvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \ecovarg{\ecovvar#5}%
        }{% optional argument
          \ecovarg[#4]{\ecovvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\ecovvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\ecovarg}[1]{(}{)}{#1}




%   Probability with measure
    \NewDocumentCommand{\prob}{ O{} e{_} s o >{\SplitArgument{1}{|}}m }{%
      \operatorname{\mathbb{#1}}%     the correlation operator
      \IfValueT{#2}{_{{#2}}}% subscript immediately after prob
      \IfBooleanTF{#3}{% *-variant
        \probarg*{\probvar#5}%
      }{% no *-variant
        \IfNoValueTF{#4}{% no optional argument
          \probarg{\probvar#5}%
        }{% optional argument
          \probarg[#4]{\probvar#5}%
        }%
      }%
    }
    \NewDocumentCommand{\probvar}{mm}{%
      #1\IfValueT{#2}{\nonscript\;\delimsize\vert\nonscript\;#2}%
    }
    \DeclarePairedDelimiterX{\probarg}[1]{(}{)}{#1}


%   Quadratic Variation
    % Quadratic Variation with Auto-adjusting Brackets
    \NewDocumentCommand{\quadvar}{ m }{%
      \left\langle #1 \right\rangle%
    }